# ■【重要】このリポジトリについて

* GitHubを利用した集団での開発フローを確立・学習するためのリポジトリです。
* お試し用の**Public**リポジトリなので、**下手なことは書かないように**
    * 誰かに見られちゃいけないことは書かない！

# ■共有リポジトリ構成について

## 共有リポジトリ

以下の２つを自動同期して、共有リポジトリにする。

* 主: GitHub(プライベートリポジトリ)
* 副: Redmineのサーバ上や220のGitリポジトリ
    * GitHubのhookでの自動更新がうまくいかなかった
    * 現在は5分毎にcronで同期させている
        * 副が主からfetchする仕組み

## 共有リポジトリの役割と運用

* 通常運営
    * GitHubに変更があれば、副リポジトリに自動反映させる
    * 副リポジトリは作業ディレクトリのブランチを固定して、ステージング環境としても利用する
* 非常時（GitHubでなにかあったとき)
    * 副リポジトリを主共有リポジトリとして使う


# ■ワークフロー

## ForkしないでGitHub Flow

* masterリポジトリはリリース対象
* 自分用にブランチを切って、開発が終わったら、masterブランチに向けてpull requestを出す
* コードレビューを経て、masterに統合
* 自分用ブランチは共有リポジトリから削除


# ■GitHub運用でもたらされるもの

## 良くなること

* Pull Request によるコードレビューの習慣
    * 文字化けさえなんとかなれば、かなりやりやすい
        * ローカルのGitHubアプリでの文字化けは甘受するとして……
* リクルーティングへの影響
    * 「プルリク」 とか「ＰＲ」とか言って見たい人いるでしょ？

## 現状とあまり変わらないこと

* ブランチ管理・リポジトリ管理
    * 現状のトピックブランチフローとあまり変わらない
    * Git Flow / Hg Flow に較べるとかなり楽
* Redmineとの連携
    * commitメッセージとチケットの自動紐付け
    * Redmine上でのコードレビュー
        * こっちでやれば文字化けなし

## 悪くなること

* GitとGitHubの使い方を覚えなければならない
    * デザイナー側にも負担が出る
* euc-jp 文字化け問題
    * 現状でもSourceTreeで起こっている。詳しくは後述

# ■ざっと試してみての課題

## euc-jp が化ける

### 文字化けの概要

* 文字の配置具合によって、化ける場合と化けない場合がある
* GitHub上でeuc-jpなコードを修正すると、UTF-8になってしまう！
* 手元のGitHubアプリで開くときも化ける

### 文字化け対策

* ブラウザの拡張機能で文字コードを変換する手もある
  * GitHubアプリでの文字化けはどうしようもない
* 何らかの自動処理で文字コードをutf-8に変換して共有リポジトリに収める。そして、本番やステージングではeuc-jpに変換する手があるが、少々リスキー
    * .gitattributes
    * たとえば、euc-jp なファイルをUTF-8なターミナルを通してgitで扱う場合の設定
      * `git config --global core.pager “nkf -w | LESSCHARSET=utf-8 less”`
* GitHub上で編集しなければ文字コードの自動変換は発生しないはず
* 下手な小細工をしないのが良さそう

## ローカル履歴が残らない

### ブランチ運用の概要

* 通常のGitHub Pull Request を行うと、feature系/topoic系にあたるローカルブランチの変更が切り捨てられる
    * 開発者の手元には残るが、publishされていないブランチがどんどん増えていくことになる。
    * 細かな変更内容とその目的が全体に共有されなくなる

### 解決案

* 手でrebase運用
    * masterにローカルリポジトリ／開発ブランチの変更内容をmergeではなくrebaseでくっつける
   * その場合、ローカルブランチのコミットをうまいこと修正しないと、masterのブランチが汚れる
       * 過去改変に慣れていないとブランチを壊すことに……
* 情報伝達をcommitメッセージに頼らずに、Redmineのチケットに残す手もある
    * commitメッセージとの二重管理になる
        * 自動でチケットにcommitメッセージを残すよう細工する？
* 情報伝達をGitHubのIssueに頼る
    * GitHubを使わなくなった時、記録が葬られる
* Pull Requestを出すときのメッセージ内容を濃密にして、mergeの際に転記する
    * ちょっと面倒。
    * commitの粒度が荒くなりすぎて、全貌を把握し辛くなる


# ■懸念

* ソースコードを外部に置くことの是非